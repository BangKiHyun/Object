# Chapter3: 역할 책임 협력

## 서론

객체지향 페러다임의 관점에서 핵심은 **역할(role), 책임(responsibility), 협력(collaboration)**이다.

객체지향 설계의 핵심은 협력을 구성하기 위해 적절한 객체를 찾고 적절한 책임을 할당하는 과정에서 드러난다. 클래스와 상속은 객체들의 책임과 협력이 어느 정도 자리를 잡은 후에 사용할 수 있는 구현 메커니즘일 뿐이다.

애플리케이션의 기능을 구현하기 위해 어떤 협력이 필요하고 협력을 위해 어떤 역할과 책임이 필요한지 고민을 하는게 유연하고 변경용이한 코드를 구현할 수 있다.

</br >

## 협력

### 협력이란?

- 협력은 하나의 객체가 다른 객체에게 무엇가를 요청하는 것이다.
- 즉, 두 객체가 상호작용을 통해 더 큰 책임을 수행하는 것이다.

### 메시지 전송

- 메시지 전송은 객체 사이이 **협력을 위해 사용할 수 있는 유일한 의사소통수단**이다.
- 자신 외의 객체에 내부 구현에 직접 접근할 수 없기 때문에 **오직 메시지 전송을 통해서만 요청을 전달**한다.
- 여기서 메시지를 어떻게 처리할지 메시지를 수신한 객체가 직접 결정한다.(자신의 일을 스스로 처리할 수 있는 자율적인 존재)
  - 자율적인 존재로 만들기 위해서는 내부 구현을 캡슐화하자!(2장에서 설명했다.)

### 협력이 설계를 위한 문맥을 결정한다

객체지향 설계에서 객체는 상태와 행동을 함께 캡슐화 하는 실행 단위다. 여기서 **객체가 가질 수 있는 상태와 행동은 객체가 참여하고 있는 협력에 의해 결정**된다. 다른말로 말하자면 협력이 바뀌면 객체가 제공해야 하는 행동 역시 바뀌어야 한다.

예를들어 영화(Movie)라는 단어를 들었을 때 대부분의 사람들은 상영하다(play)라는 행동을 수행할 것이라 생각할 수 있다. 하지만 2장에서 봤던 영화 예매 시스템 안의 영화는 단순히 요금을 계산(calculateMovieFee)하는 행동만을 하고있다.

왜? 2장에서의 영화는 영화를 예매하기 위한 협력에 참여하고 있고 그 안에서 요금을 계산하는 책임을 갖고있기 떄문이다.

위 예시를 통해 보았듯이 **객체가 참여하는 협력에 의해 객체를 구성하는 행동과 상태를 결정**한다. 따라서 협력은 객체를 설계하는데 필요한 일종의 **문맥(context)를 제공**한다.

</br >

## 책임

### 책임이란?

- 객체가 협력에 참여하기 위해 수행하는 로직
- 즉, 객체가 수행하는 행동

### 객체의 책임

객체의 책임은 두 가지로 나눠진다.

- 무엇을 알고 있는가(아는 것, knowing)

  - 사적인 정보에 관해 아는 것
  - 관련된 객체에 아는 것
  - 자신이 유도하거나 계산할 수 있는 것에 관해 아는 것

  ex: Movie: 가격과 어떤 할인 정책이 적용됐는지 알고 있어야 한다.

  ​      Screening: 자신이 상영할 영화를 알고 있어야 한다.

  

- 무엇을 할 수 있는가(하는 것, doing)

  - 객체를 생성하거나 계산을 수행하는 등의 스스로 하는 것
  - 다른 객체의 행동을 시작하는 것
  - 다른 객체의 활동을 제어하고 조절하는 것

  ex: Movie: 요금을 계산하는 것

  ​      Screening: 영화를 예매하는 것

아는 것과 하는 것은 객체에게 책임 할당에 대한 힌트를 제공한다.

</br >

### 책임 할당

객체지향 설계는 시스템의 책임을 완료하는 데 필요한 더 작은 책임을 찾아내고 이를 객체들에게 할당하는 반복적인 과정을 통해 모양을 갖춰간다. 책임 할당에 가장 기본적인 방법은 **책임을 수행하는 데 필요한 정보를 가장 잘 알고 있는 전문가에게 그 책임을 할당**하는 것이다.

- 정보 전문가 패턴(INFORMATION EXPERT PATTER)
  - 책임을 수행하는 데 필요한 정보를 가장 잘 알고 있는 전문가에게 책임 할당하는 패턴

### 영화 예매 시스템 예제로 살펴보기

- 영화를 예매하기 위해 필요한 정보: 상영 시간, 기본 요금
  - 이 정보를 소유하고 있거나 해당 정보의 소유자를 가장 잘 알고 있는 전문가: Screening
- 영화 예매를하기 위해 예매 가격을 계산하기 위해 필요한 정보: 영화 가격, 할인 정책
  - 이 정보를 가장 잘 알고 있는 전문가: Movie

</br >

### 책임 주도 설계(Responsibility Driven Design, RDD)

어떤 책임을 선택하느냐가 전체저인 설계의 방향과 흐름을 결정한다. 이처럼 책임을 찾고 책임을 수행할 적절한 객체를  찾아 책임을 할당하는 방식으로 협력을 설계하는 방법을 **책임 주도 설계**라 부른다.

### 책임 주도 설계 방법

1. 시스템이 사용자에게 제공해야 하는 기능인 시스템 책임을 파악한다.
2. 시스템 책임을 더 작은 책임으로 분할한다.
3. 분할된 책임을 수행할 수 있는 적절한 객체나 역할을 찾아 책임을 할당한다.
4. 객체가 책임을 수행하는 도중 다른 객체의 도움이 필요한 경우 이를 책임질 적절한 객체나 역할을 찾는다.
5. 해당 객체나 역할에게 책임을 할당함으로써 두 객체가 협력하게 된다.

</br >

### 메시지가 객체를 결정하게 하자

결론부터 말하자면 객체가 추상적이면서 최소한의 인터페이스를 가지게 하고 싶다면 **메시지가 객체를 선택하게 하라**

- 최소한의 인터페이스
  - 필요한 메시지가 식별될 때까지 객체의 퍼블릭 인터페이스에 어떤 것도 추가하지 않기 때문에 애플리케이션에 꼭 필요한 크기의 퍼블릭 인터페이스를 가질 수 있다.

- 추상적인 인터페이스
  - 객체의 인터페이스는 무엇(what)을 하는지 표현해야 하지만 어떻게(how) 수행하는지를 노출해서는 안 된다.
  - 메시지는 외부의 객체가 요청하는 무언가를 의미하기 때문에 무엇을 수행할지에 초점을 맞추는 인터페이스를 얻을 수 있다.

</br >

### 행동이 상태를 결정하게 하자

객체지향 설계를 할 때 가장 흔히하는 **실수가 객체의 행동이 아니라 상태에 초점을 맞추는 경우**다. 이 말은 객체에 필요한 상태가 무엇인지 먼저 결정하고, 그 후에 상태에 필요한 행동을 결정한다. 이런 방식은 객체의 내부 구현이 객체의 퍼블릭 인터페이스에 노출되도록 만들기 쉽기 때문에 **캡슐화를 저해**할 수 있다.

- 상태는 단지 객체가 행동을 정상적으로 수행하기 위해 필요한 재료
- 객체가 가질 수 있는 상태는 행동을 결정하고 나서야 결정할 수 있다.
- 협력이 객체의 행동을 결정하고 행동이 상태를 결정한다.

</br >

## 역할

객체가 특정한 협력 안에서 수행하는 책임의 집합을 역할이라 한다.

협력을 모델링할 때 특정한 객체가 아니라 역할에게 책임을 할당한다고 생각하는게 좋다.

### 유연하고 재사용 가능한 협력

역할은 유연하고 재사용 가능한 협력을 찾을 수 있게 해준다.

- 영화 예매 시스템에서의 할인 요금 계산

  Movie가 가격을 계산하기 위해 할인 요금이 필요하기 때문에 할인 요금을 계산하라는 메시지를 전송한다.

  할인 요금을 계산하기위한 정책은 2가지가 있다

  - 객체에 초점
    - 객체에 초점을 맞췄을 때 두 종류의 객체가 참여하는 협력을 개별적으로 만든다.
    - 코드 중복 발생!

  - 책임에 초점
    - 책임에 관점에서 두 종류를 바라보면 모두 할인 요금 계산이라는 동일한 책임을 수행한다.
    - 할인 요금을 계산하라는 메시지에 응답할 수 있는 대표자를 생각한다면 두 협력을 하나로 통합할 수 있는, 두 종류의 객체를 교대로 바꿔 끼울 수 있는 슬롯으로 생각할 수 있다.
    - 이 슬롯이 바로 역할이다.

역할은 다른 것으로 교체할 수 있는 책임의 집합이다!

</br >

### 객체 vs 역할

역할은 객체가 참여할 수 있는 일종의 슬롯, 그러나 오직 한 종류의 객체만 협력에 참여하는 상황에서 역할이라는 개념을 고려해야되나?

역할이라는 개념을 생략하고 직접 객체를 이용해 협력을 설계하는게 더 낫지 않을까?

>레베카 워프스브록
>
>만약 동일한 종류의 객체가 하나의 역할을 항상 수행한다면 둘은 동일한 것이다. 하지만 어떤 협력에서 하나 이상의 객체가 동일한 책임을 수행할 수 있다면 역할은 서로 다른 방법으로 실행할 수 있는 책임의 집합이 된다. 역할이란 프로그램이 실행될 때 소프트웨어 기계 장치에서 적절한 객체로 메워 넣을 수 있는 하나의 슬롯으로 생각할 수 있다.
>
>배우가 극중에서 믿을 수 있는 배역을 맡아서 하려는 것처럼 객체는 의미 있는 역할을 정의하는 책임을 통해 애플리케이션의 기능을 담당하게 된다.

정리하자면, 후보가 여러 종류의 객체에 의해 수행될 필요가 있다면 그 후보는 역할이 되지만, 단지 한 종류의 객체만이 협력에 참여할 필요가 있다면 후보는 객체가 된다.

</br >

### 역할과 추상화

역할은 공통의 책임을 바탕으로 객체의 종류를 숨기기 때문에 이런 관점에서 역할을 객체의 추상화로 볼 수 있다.

### 추상화 장점

- 세부 사항에 억눌리지 않고 상위 수준의 정책을 쉽고 간단하게 표현할 수 있다.

  즉, 불필요한 세부 사항을 생략하고 핵심적인 개념을 강조할 수 있다.

  - 예로 구체적인 할인 정책과 할인 조건의 조합을 고려하지 않고 상위 수준에서 협력을 설명할 수 있다.

- 설계를 유연하게 만들 수 있다.

  - 역할이 다양한 종류의 객체를 끼워 넣을 수 있는 일종의 슬롯이다. 이러한 역할은 다양한 환경에서 다양한 객체들을 수용할 수 있게 도와주기 때문에 협력을 유연하게 만든다.

